# 自动化实验设计

自动化实验需要以下几点要素：

- 灵活的运动装置（平移、旋转）
- 精确的定位能力
- 无线装置
- 实验失败报警系统

## 运动+定位装置

统一的运动装置设计：使用20kg载重的全向轮小车，通过头顶拍摄天花板来实现精准定位和定Yaw角度，再通过周围的另外两个摄像机记录实验过程，保证数据异常有据可查

具体实现方案为：小车摄像头照射天花板，初期从0走到100m，然后图像处理定标（定0角度）

所有的定位均以天花板为准，假设摄像机精度为640×480，拍摄面积为5m×5m，则定位精度为1cm，我们实际使用10cm~30cm的定位精度即可，这样没有绝对误差，只有相对误差

tag移动，reader不移动接插线板和强处理能力电脑，保证供电和数据记录能力（录制的视频资源）

Purui: 所有实验只需要1维移动，Yaw角度应该用旋转平台实现。应该使用带导引的方案。了解了磁带导引车，只能检测左右移动，不能检测前后位移。不能放弃CV方案，但建议用布条打印二维码（长度可达50m），以提供比天花板更高的信噪比。

Wy: 减少对环境的依赖，布条二维码贴在天花板上成本太大，在地面同样比较困难，能够利用现有的最好；70°FOV的摄像机可以很好地利用走廊两侧的棱角来进行角度定位，长方格子和灯具可以进行前后定位，辅以小车自身的精细调节。我们只需要target跟手动移动位置一样或者更好的定位精度即可

![](44a4bae32b37fd86dca79c67eaf40cc.png)


## 无线装置

使用MT7628，已经实现mjpeg streaming，还需要后续的opencv处理能力

同时实现控制单片机的程序，需要交叉编译，通过socket直连reader端，一旦socket断开发送警告给实验者，一旦定位超出额定数额报告错误给实验者并立刻停机

## 失败报警系统

使用一台联网的手机，reader端的电脑负责adb控制打电话，命令为`./adb shell am start -a android.intent.action.CALL tel:xxxxxxxxxxx`，adb下载安装参考https://www.xda-developers.com/install-adb-windows-macos-linux

因为skype不能直接打电话，还需要点击一下屏幕才能播出去，使用adb模拟点击事件

首先获取屏幕的大小：`./adb shell getevent -p` 找到`0035`（宽）和`0036`（高），会找到

```shell
0035 : value 0, min 0, max 1079, fuzz 0, flat 0, resolution 0 
0036 : value 0, min 0, max 1919, fuzz 0, flat 0, resolution 0
```

正好和屏幕尺寸是一样的，不需要进行放缩（如需要详见[CSDN博客](<https://blog.csdn.net/yuanzihui/article/details/52871652>)），然后运行`./adb shell getevent`，手指按一下需要点击的位置，还是找到`0035`和`0036`获取坐标

```shell
/dev/input/event2: 0003 0035 00000204
/dev/input/event2: 0003 0036 000006f9
```

计算：`0204=516,06f9=1785`，然后`./adb shell input tap 516 1785`，这个中间可能需要延迟点击